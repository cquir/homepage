<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Christian Quirouette</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
	<script type="module">
	import * as THREE from 'https://unpkg.com/three/build/three.module.js';

	const scene = new THREE.Scene();
	const camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);

	const renderer = new THREE.WebGLRenderer();
	renderer.setSize(window.innerWidth,window.innerHeight);
	document.body.appendChild(renderer.domElement);

	const geometry = new THREE.BoxGeometry(1,1,1);
	const material = new THREE.MeshBasicMaterial({color:0x00ff00});
	const cube = new THREE.Mesh(geometry,material);
	cube.position.set(-1,1,0);
	scene.add(cube);

	let positions = [
		[-1,0,0],
		[-1,-1,0],
		[0,-1,0],
		[0,-2,0],
		[1,-2,0],
		[1,-3,0],
		[2,-3,0],
		[2,-4,0],
		[2,-4,1],
		[2,-5,1],
		[2,-5,2]
	];

	const staircaseMaterial = new THREE.MeshBasicMaterial({color:0x00ff00,wireframe:true});
	for (let i=0; i <positions.length; i++){
		const staircaseElement = new THREE.Mesh(geometry,staircaseMaterial);
		staircaseElement.position.fromArray(positions[i]);
		scene.add(staircaseElement);
	}	

	const d = 4;
	camera.position.x = d;
	camera.position.y = 0;
	camera.position.z = d;
	camera.lookAt(0,-3,0);

	const clock = new THREE.Clock();

	let theta = 0;

	let idx = 0;

	let a = 0.2;
	let b = 1.0;

	function rotate(theta,idx){

		let start = new THREE.Vector3(-1,1,0);
		let pivot = new THREE.Vector3(-0.5,0.5,0.5);
		let axis = new THREE.Vector3(0,0,0);

		if (idx < 3){
			start.addScaledVector(new THREE.Vector3(1,-1,0),idx)
			pivot.addScaledVector(new THREE.Vector3(1,-1,0),idx)
			axis.z = 1;
		} else {
			start.addScaledVector(new THREE.Vector3(1,-1,0),3).addScaledVector(new THREE.Vector3(0,-1,1),idx-3)
			pivot.addScaledVector(new THREE.Vector3(1,-1,0),3).addScaledVector(new THREE.Vector3(0,-1,1),idx-3)
			theta = -theta;
			axis.x = 1;
		}

		cube.position.copy(start);
		cube.position.sub(pivot);
		cube.position.applyAxisAngle(axis,-theta);
		cube.position.add(pivot);
		cube.setRotationFromAxisAngle(axis,-theta);
	}

	function animate() {
		requestAnimationFrame(animate);

		let dt = clock.getDelta();

		if (cube.position.y > -5){
			theta = theta+(a+b*theta)*dt > Math.PI? Math.PI: theta+(a+b*theta)*dt;
			rotate(theta,idx);
		}

		if (theta == Math.PI){
			theta = 0
			idx += 1
		}

		renderer.render(scene,camera);
	}

	animate();
	</script>
	</body>
</html>
